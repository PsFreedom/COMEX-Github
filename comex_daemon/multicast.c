#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <signal.h>

#include <infiniband/verbs.h>
#include <infiniband/arch.h>
#include <rdma/rdma_cma.h>

/*
 *  * Defines
 *   */
#define NUM_RECV_BUFS	8

#define MAX_SEND_WR	1	
#define MAX_SEND_SGE	1

#define MAX_RECV_WR	NUM_RECV_BUFS
#define MAX_RECV_SGE	1

#define JOIN_STRING 	"Hello World!"
#define JOIN_SIZE	strlen(JOIN_STRING)+1	// +1 for NULL char
#define LEAVE_STRING 	"Goodbye World!"
#define LEAVE_SIZE	strlen(LEAVE_STRING)+1	// +1 for NULL char
#define GID_STR_SIZE	sizeof("00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00")+1 	// +1 for NULL char

#define CQ_DEPTH	MAX_SEND_WR + MAX_RECV_WR

/*
 *  * use the leave string size since its longer and will hold both the
 *   * leave and join strings;
 *    */
struct buffer {
	char msg[LEAVE_SIZE];
};

/*
 *  * UD requires you post a recv buffer large enough to
 *   * receive the GRH as well as the message being sent.
 *    */
struct ud_recv{
	struct ibv_grh grh;
	struct buffer buf; 
};

/*
 *  * Control Block used to store all data structures and context information.
 *   */
struct rdma_cb {

	/*
 *  	 * Command line args
 *  	  	 */
	struct sockaddr_in bind_sin;
	struct sockaddr_in mc_sin;
	
	/*
 * 	 * RDMA CM data structures
 * 	 	 */
	struct rdma_event_channel *event_channel;
	struct rdma_cm_id *cm_id;

	/*
 * 	 * IB data structures
 * 	 	 */
	struct ibv_comp_channel *comp_channel;
	struct ibv_cq *cq;
	struct ibv_pd *pd;
	struct ibv_qp *qp;
	struct ibv_ah *ah;

	uint32_t remote_qpn;
	uint32_t remote_qkey;

	/*
 * 	 * Memory Region and data buffers
 * 	 	 */
	struct ibv_mr *recv_mr;
	struct ud_recv recv_buffer[NUM_RECV_BUFS];
	
	struct ibv_mr *send_mr;
	struct buffer send_buffer;
};

/*
 *  * Function Prototypes
 *   */
int setup_common(struct rdma_cb *);
void cleanup_common(struct rdma_cb *);
int do_mc_client(struct rdma_cb *,int);
int post_send(struct rdma_cb *);
int post_recv(struct rdma_cb *, int index);
int process_recv(struct rdma_cb *, struct ibv_wc *);
int do_poll(struct rdma_cb *);
int process_rdma_cm_event(struct rdma_cb *, enum rdma_cm_event_type);
char* gid_2_str(union ibv_gid *, char *);

/*
 *  * Cheat and use a global cb for the interrupt handler
 *   */
struct rdma_cb *g_cb;
int mc_exit = 0;

/*
 *  * use a signal handler to properly clean up when the user presses
 *   * <ctrl c>.  We will most likely be blocked waiting for a receive
 *    * event, so in order to wake up the thread someone has to join the
 *     * MC group or we have to post a send. Rather than wait, it's easier 
 *      * just to post a send (with a goodbye message). 
 *       */
static void
signal_handler(int signal) {
	int i=0;
	mc_exit = 1;
	strncpy((char *)g_cb->send_buffer.msg, LEAVE_STRING, LEAVE_SIZE);
	//to kill the server send #iter mcast messages
	//	for (i=0;i<CQ_DEPTH;i++){
	//			post_send(g_cb);
	//				}
	//				}
	//
	//				char *
	//				gid_2_str(union ibv_gid *gid, char *strgid) {
	//
	//				        snprintf(strgid, GID_STR_SIZE, "%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x",
	//				                        gid->raw[0], gid->raw[1], gid->raw[2], gid->raw[3], gid->raw[4], gid->raw[5],
	//				                                        gid->raw[6], gid->raw[7], gid->raw[8], gid->raw[9], gid->raw[10], gid->raw[11],
	//				                                                        gid->raw[12], gid->raw[13], gid->raw[14], gid->raw[15]);
	//
	//				                                                        	return strgid;
	//				                                                        	}
	//
	//				                                                        	int
	//				                                                        	process_recv(struct rdma_cb *cb, struct ibv_wc *wc) {
	//
	//
	//				                                                        		struct ud_recv *recv;
	//				                                                        			char strgid[GID_STR_SIZE];
	//				                                                        				int index, err;
	//
	//				                                                        					index = (int)wc->wr_id;
	//				                                                        						recv = &cb->recv_buffer[index];
	//				                                                        							fprintf(stdout, "Recieved Message(index %d): ***%s***, from GID: %s with source QP number: 0x%x\n", 
	//				                                                        										index, recv->buf.msg, gid_2_str(&recv->grh.sgid, strgid), wc->src_qp);
	//
	//				                                                        											/*
	//				                                                        												 * Repost our RECV Buffer.
	//				                                                        												 	 */
	//				                                                        												 	 	err = post_recv(cb, index);
	//
	//				                                                        												 	 		return err;
	//				                                                        												 	 		}
	//
	//				                                                        												 	 		int
	//				                                                        												 	 		do_poll(struct rdma_cb *cb) {
	//
	//				                                                        												 	 			struct ibv_wc wc;
	//				                                                        												 	 				int err;
	//				                                                        												 	 					int num = 0;
	//
	//				                                                        												 	 						while ((err = ibv_poll_cq(cb->cq, 1, &wc)) == 1) {
	//
	//				                                                        												 	 								if (wc.status) {
	//				                                                        												 	 											fprintf(stderr, "Completion failed for event: %d, status: %d\n", wc.opcode, wc.status);
	//				                                                        												 	 														return -1;
	//				                                                        												 	 																}
	//
	//				                                                        												 	 																		switch (wc.opcode) {
	//				                                                        												 	 																				case IBV_WC_SEND:
	//				                                                        												 	 																							num++;
	//				                                                        												 	 																										/*
	//				                                                        												 	 																													 * Nothing to do once the send completes... if it wasnt successful it would have
	//				                                                        												 	 																													 			 * failed the above test.
	//				                                                        												 	 																													 			 			 */
	//				                                                        												 	 																													 			 			 			break;
	//
	//				                                                        												 	 																													 			 			 					case IBV_WC_RECV:
	//
	//				                                                        												 	 																													 			 			 								/*
	//				                                                        												 	 																													 			 			 											 * Process our RECV
	//				                                                        												 	 																													 			 			 											 			 */
	//				                                                        												 	 																													 			 			 											 			 			err = process_recv(cb, &wc);
	//				                                                        												 	 																													 			 			 											 			 						if (err) {
	//				                                                        												 	 																													 			 			 											 			 										fprintf(stderr, "Failed processing a receive\n");
	//				                                                        												 	 																													 			 			 											 			 														return err;
	//				                                                        												 	 																													 			 			 											 			 																	}
	//				                                                        												 	 																													 			 			 											 			 																				num++;
	//				                                                        												 	 																													 			 			 											 			 																							break;
	//
	//				                                                        												 	 																													 			 			 											 			 																									default:
	//				                                                        												 	 																													 			 			 											 			 																												fprintf(stderr, "Received unhandled completion type: %d\n", wc.opcode);
	//				                                                        												 	 																													 			 			 											 			 																															return -1;
	//				                                                        												 	 																													 			 			 											 			 																																	}
	//				                                                        												 	 																													 			 			 											 			 																																		}
	//
	//				                                                        												 	 																													 			 			 											 			 																																			return num;
	//				                                                        												 	 																													 			 			 											 			 																																			}
	//
	//				                                                        												 	 																													 			 			 											 			 																																			int
	//				                                                        												 	 																													 			 			 											 			 																																			do_completion(struct rdma_cb *cb) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																				struct ibv_cq *event_cq;
	//				                                                        												 	 																													 			 			 											 			 																																					void *event_context;
	//				                                                        												 	 																													 			 			 											 			 																																						int err;
	//				                                                        												 	 																													 			 			 											 			 																																							int num = 0;
	//
	//				                                                        												 	 																													 			 			 											 			 																																								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 * Block until we get a completion event.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 	err = ibv_get_cq_event(cb->comp_channel, &event_cq, &event_context);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 				fprintf(stderr, "Failed getting CQ event: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 						return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 * Need to rerequest notification so we will get an event the next
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 * time a WR completes.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 	err = ibv_req_notify_cq(cb->cq, 0);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        fprintf(stderr, "Failed to request notification: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        		return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        			}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        				/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 * Process the Completion event.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 	num = do_poll(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 		if (num < 0) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 				return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 					}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 						/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 * Ack the CQ Event
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 	ibv_ack_cq_events(cb->cq, 1 );
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 		return num;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 		}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 		int
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 		ib_setup_common(struct rdma_cb *cb) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 			struct ibv_qp_init_attr qp_init_attrs;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 				int err;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 					/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 * Allocate the Protection Domain
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 	cb->pd = ibv_alloc_pd(cb->cm_id->verbs);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 		if (!cb->pd) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 				fprintf(stderr, "Error Allocating Protection Domain\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 						return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 * Create a Completion Channel
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 	cb->comp_channel = ibv_create_comp_channel(cb->cm_id->verbs);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 		if (!cb->comp_channel) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 				fprintf(stderr, "Error Creating a Completion Channel\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 						return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 * Create a Completion Queue
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 	cb->cq = ibv_create_cq(cb->cm_id->verbs, CQ_DEPTH, cb, cb->comp_channel, 0);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 		if (!cb->cq) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 				fprintf(stderr, "Error Allocating Completion Queue\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 						return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 * Request Event Notification.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 	err = ibv_req_notify_cq(cb->cq, 0);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                fprintf(stderr, "Failed to request notification: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                		return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                			}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                				/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 * Initialize the QP attributes
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 	memset(&qp_init_attrs, 0, sizeof(qp_init_attrs));
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 		qp_init_attrs.send_cq = cb->cq;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 			qp_init_attrs.recv_cq = cb->cq;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 				qp_init_attrs.qp_type = IBV_QPT_UD;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 					qp_init_attrs.cap.max_send_wr = MAX_SEND_WR;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 						qp_init_attrs.cap.max_send_sge = MAX_SEND_SGE;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 							qp_init_attrs.cap.max_recv_wr = MAX_RECV_WR;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 								qp_init_attrs.cap.max_recv_sge = MAX_RECV_SGE;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 									/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 * Create the Queue Pair using the RDMA CM
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 	err = rdma_create_qp(cb->cm_id, cb->pd, &qp_init_attrs);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 				fprintf(stderr, "Error Creating Queue Pair\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 						return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 								cb->qp = cb->cm_id->qp;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 									fprintf(stdout, "Created QP: 0x%x\n", cb->qp->qp_num);
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 										/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 * Register our Memory Regions
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 */ 
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 	cb->recv_mr = ibv_reg_mr(cb->pd, &cb->recv_buffer, sizeof(cb->recv_buffer), IBV_ACCESS_LOCAL_WRITE);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 		if (!cb->recv_mr) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 				fprintf(stderr, "Error registering recv buffer\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 						return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 								cb->send_mr = ibv_reg_mr(cb->pd, &cb->send_buffer, sizeof(cb->send_buffer), 0);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 									if (!cb->send_mr) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 											fprintf(stderr, "Error registering send buffer\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 													return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 														}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 															return 0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 															}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 															void
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 															cleanup_common(struct rdma_cb *cb) {
	//
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																if (cb->send_mr) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																		ibv_dereg_mr(cb->send_mr);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																			}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																				if (cb->recv_mr) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																						ibv_dereg_mr(cb->recv_mr);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																								if (cb->qp) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																										rdma_destroy_qp(cb->cm_id);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																											}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																												if (cb->comp_channel) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																														ibv_destroy_comp_channel(cb->comp_channel);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																															}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																if (cb->cq) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																		ibv_destroy_cq(cb->cq);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																			}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																				if (cb->pd) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																						ibv_dealloc_pd(cb->pd);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																								if (cb->cm_id) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																										rdma_destroy_id(cb->cm_id);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																											}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																												if (cb->event_channel) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																														rdma_destroy_event_channel(cb->event_channel);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																															}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																free(cb);
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																	return;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																	}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																	int
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																	post_recv(struct rdma_cb *cb, int index) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																		
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																			struct ibv_recv_wr recv_wr, *bad_wr;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																				struct ibv_sge recv_sge;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																					int err;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																						/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 * Initialize the recv sge
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 	recv_sge.addr = (uint64_t)&cb->recv_buffer[index];
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 		recv_sge.length = sizeof(cb->recv_buffer[index]);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 			recv_sge.lkey = cb->recv_mr->lkey;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 				/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 * Initialize the WR
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 	memset(&recv_wr, 0, sizeof(recv_wr));
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 		recv_wr.wr_id = index;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 			recv_wr.sg_list = &recv_sge;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 				recv_wr.num_sge = 1;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 					/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 * Issue the post
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 	err = ibv_post_recv(cb->qp, &recv_wr, &bad_wr);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 				fprintf(stderr, "Error posting recv work request: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 						return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 								fprintf(stdout, "Posted received buffer 0x%llx with index %d\n", (unsigned long long)recv_sge.addr, index);
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 									return 0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 									}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 									int
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 									post_send(struct rdma_cb *cb) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 										struct ibv_send_wr send_wr, *bad_wr;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 											struct ibv_sge send_sge;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 												static int send_cnt = 0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 													int err;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 														memset(&send_wr, 0, sizeof(send_wr));
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 															send_wr.wr_id = send_cnt++;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																send_wr.opcode = IBV_WR_SEND;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																	send_wr.send_flags = IBV_SEND_SIGNALED;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																		send_wr.num_sge = 1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																			send_wr.sg_list = &send_sge;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																				send_wr.wr.ud.ah = cb->ah;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																					send_wr.wr.ud.remote_qpn = cb->remote_qpn;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																						send_wr.wr.ud.remote_qkey = cb->remote_qkey;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																							send_sge.addr = (uint64_t)&cb->send_buffer;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																								send_sge.length = sizeof(cb->send_buffer);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																									send_sge.lkey = cb->send_mr->lkey;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																										err = ibv_post_send(cb->qp, &send_wr, &bad_wr);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																											if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																													fprintf(stderr, "Error posting send work request: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																															return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																	return 0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																	}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																	int
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																	process_rdma_cm_event(struct rdma_cb *cb, enum rdma_cm_event_type expected_event) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																		struct rdma_cm_event *cm_event;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																			int err;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																				/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 * Wait for the RDMA_CM event to complete
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 	err = rdma_get_cm_event(cb->event_channel, &cm_event);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 				fprintf(stderr, "RDMA get CM event failed: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 						return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 * Process the RDMA CM event based on what we expect to receive
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 	if (cm_event->event != expected_event) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 			fprintf(stderr, "RDMA CM event (%s) failed: %s: %d\n", rdma_event_str(expected_event), 
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 						rdma_event_str(cm_event->event), cm_event->status);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 								err = -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 										goto ack;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 											}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 												/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 * If this is our join event then we need to save off the qpn and qkey, as
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 * well as create an address handle for future SEND operations.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 	if (cm_event->event == RDMA_CM_EVENT_MULTICAST_JOIN) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 			cb->remote_qpn = cm_event->param.ud.qp_num;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 					cb->remote_qkey = cm_event->param.ud.qkey;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 							cb->ah = ibv_create_ah(cb->pd, &cm_event->param.ud.ah_attr);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 									if (!cb->ah) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 												fprintf(stderr, "Error creating address handle\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 															err = -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																	}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																			
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																				}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																				ack:
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																					rdma_ack_cm_event(cm_event);
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																						return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																						}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																						int setup_rdma(struct rdma_cb *cb){
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																							int err=0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 * Initialize the RDMA CM Event channel
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 	cb->event_channel = rdma_create_event_channel();
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 		/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 * Create an RDMA CM id
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 	err = rdma_create_id(cb->event_channel, &cb->cm_id, cb, RDMA_PS_UDP);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 				fprintf(stderr, "Error creating RDMA CM ID: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 						return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 * Bind on the interface based on the ip passed in on the command line.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 	err = rdma_bind_addr(cb->cm_id, (struct sockaddr *)&cb->bind_sin);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 				fprintf(stderr, "Error binding to address/port: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 						return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 * Resolve the addr
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 	err = rdma_resolve_addr(cb->cm_id, (struct sockaddr *)&cb->bind_sin, (struct sockaddr *)&cb->mc_sin, 3000);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 				fprintf(stderr, "Could not resolve RDMA ADDR: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 						return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 							}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 * Process the resolve addr event.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 	err = process_rdma_cm_event(cb, RDMA_CM_EVENT_ADDR_RESOLVED);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 				return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 					}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 						/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 * Now that we have the ADDR resolved we need to do our IB setup.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 	err = ib_setup_common(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 				return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 					}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 						return 0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 						}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 						int
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 						do_mc_client(struct rdma_cb *cb,int iterations) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 							int i, err=0,num=0;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 								/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 * Set the global cb
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 	g_cb = cb;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 		err = setup_rdma(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 			if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 					fprintf(stderr, "Failed to setup rdma: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 							return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 								}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 									/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 * Join the multicast group
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 	fprintf(stdout, "Joining MC group: %s\n", inet_ntoa(cb->mc_sin.sin_addr));
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 		err = rdma_join_multicast(cb->cm_id, (struct sockaddr *)&cb->mc_sin, cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 			if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 					fprintf(stderr, "Failed joining the multicast group: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 							return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 								}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 									/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 * Process the join request.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 	err = process_rdma_cm_event(cb, RDMA_CM_EVENT_MULTICAST_JOIN);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 				return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 					}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 						strncpy((char *)cb->send_buffer.msg, JOIN_STRING, JOIN_SIZE);
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 							fprintf(stdout, "Sending ***%s*** to the multicast group %d times\n", cb->send_buffer.msg,iterations);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 								i = 0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 									while (i<iterations) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 											err = post_send(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 													if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																goto leave_mc_group;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																		}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																				/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 * Wait for and process the send completion
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 		num = do_completion(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 				if (num<0) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 							goto leave_mc_group;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 									}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 											i += num;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 												}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 													printf("sent #%d mcasts successfully ! \n",i);
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 													leave_mc_group:
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 														/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 * Leave the multicast group
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 	fprintf(stdout, "Leaving Multicast group\n");
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 		err = rdma_leave_multicast(cb->cm_id, (struct sockaddr *)&cb->mc_sin);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 			if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 					fprintf(stderr, "Error leaving multicast group: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 							return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 								}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 									return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 									}
	//
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 									int
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 									do_mc_server(struct rdma_cb *cb,int iterations) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 										int i, err=0,num;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 											/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 * Setup a signal handler to catch interrupt key strokes and allow
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 * the program to properly cleanup/exit.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 	signal(SIGINT, signal_handler);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 		signal(SIGPIPE, signal_handler);
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 			/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 * Set the global cb
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 	g_cb = cb;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 		err = setup_rdma(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 			if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 					fprintf(stderr, "Failed to setup rdma: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 							return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 								}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 									/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 * Before joining the multicast group we need to make sure and have
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 * some recvs posted.  That way nothing is missed once the join completes.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 	for (i = 0; i < NUM_RECV_BUFS; i++) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 			post_recv(cb, i); 
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 				}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 					/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 * Join the multicast group
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 	fprintf(stdout, "Joining MC group: %s\n", inet_ntoa(cb->mc_sin.sin_addr));
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 		err = rdma_join_multicast(cb->cm_id, (struct sockaddr *)&cb->mc_sin, cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 			if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 					fprintf(stderr, "Failed joining the multicast group: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 							return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 								}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 									/* 
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 * Process the join request.
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 	err = process_rdma_cm_event(cb, RDMA_CM_EVENT_MULTICAST_JOIN);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 		if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 				return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 					}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 						fprintf(stdout, "Waiting to receive data from members joining the MC group... <ctrl-c> to exit\n");
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 							/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 * For simplicity this code will receive number of <iterations> mcast messages and then
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 * terminates
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 */
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 	i=0;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 		while (i<iterations) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 				num = do_completion(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 						if (num < 0) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 									goto leave_mc_group;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 											}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 													printf("received %d completions successfully \n",num);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 															i+= num;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																	printf("Total mcast received %d out of %d \n",i,iterations);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																		}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																		leave_mc_group:
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																			/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 * Leave the multicast group
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 	fprintf(stdout, "Leaving Multicast group\n");
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 		err = rdma_leave_multicast(cb->cm_id, (struct sockaddr *)&cb->mc_sin);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 			if (err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 					fprintf(stderr, "Error leaving multicast group: %d\n", err);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 							return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 								}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 									return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 									}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 									void
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 									usage(char *prog) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 										
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 											fprintf(stderr, "Usage: %s -a <local addr> -m <multicast addr> [-i <num of iterations>] [-s (for server mode)] \n", prog);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 												return;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 												}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 												int 
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 												main(int argc, char **argv) {
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 													struct rdma_cb *cb;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 														int opt, mc_addr, local_addr, err = 0,iter = 1,server = 0;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 															/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 * Allocate an initialize the control block structure
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 	cb = malloc(sizeof(*cb));
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 		if (!cb) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 				fprintf(stderr, "Could not allocate memory for the control block\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 						return -1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 							}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 								memset(cb, 0, sizeof(*cb));
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 									cb->bind_sin.sin_family = cb->mc_sin.sin_family = AF_INET;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 										local_addr = mc_addr = 0;
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 											/*
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 * Validate the command line
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 */
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 	while ((opt=getopt(argc, argv, "a:m:i:s")) != -1) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 			switch (opt) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 					case 'a':
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 								local_addr = 1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 											err = inet_aton(optarg, &cb->bind_sin.sin_addr);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 														if (!err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																		err = 1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																						fprintf(stderr, "inet_aton failed on address: %s\n", optarg);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																										goto out;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																													}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																break;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																		case 'm':
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																					mc_addr = 1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																								err = inet_aton(optarg, &cb->mc_sin.sin_addr);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																											if (!err) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																															err = 1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																			fprintf(stderr, "inet_aton failed on address: %s\n", optarg);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																							goto out;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																										}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																													break;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																															case 'i':
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																				iter = atoi(optarg);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																									break;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																											case 's':
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																server = 1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																					break;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																							default:
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																										usage(argv[0]);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																													goto out;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																															}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																	if (local_addr && mc_addr) {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																			if(!server){
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																						printf("CLIENT ... sending %d mcast messages\n",iter);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																									err = do_mc_client(cb,iter);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																											} else {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																														printf("SERVER ... waiting for %d mcast messages\n",iter);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																	err = do_mc_server(cb,iter);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																			}
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																				} else {
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																						err = 1;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																								usage(argv[0]);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																									}
	//
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																									out:
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																										printf("DONE ...\n");
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																											cleanup_common(cb);
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																												return err;
	//				                                                        												 	 																													 			 			 											 			 																																									 	 									 	 	 		        					 	 							 	 						 	 									 	 									 	 									 	 		                					 	 										 	 											 	 																																																							 	 					 	 						 	 																																					 	 									 	 													 	 	 																									 	 			 	 									 	 									 	 									 	 							 	 									 	 										 	 										 	 																						 		 															 	 												 	 	 				 	 										 	 	 						 	 										 	 								 	 	 																				 	 																 	 												 	 																																																																																																																												}
	//
	//
